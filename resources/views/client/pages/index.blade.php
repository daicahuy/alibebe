@extends('client.layouts.master')

@section('content')
    <!-- Home Section Start -->


    <section class="home-section pt-2">
        <div class="container-fluid-lg">
            <div class="row g-4">
                <div class="col-xl-8 ratio_65">
                    <div class="home-contain h-100">
                        <div class="h-100">
                            <img src="https://cdn-media.sforum.vn/storage/app/media/trannghia/Apple-MacBook-Air-M4-ra-mat-1.jpg"
                                class="bg-img blur-up lazyload" alt="">
                        </div>
                        {{-- <div class="home-detail p-center-left w-75">
                            <div>
                                <h6>Exclusive offer <span>30% Off</span></h6>
                                <h1 class="text-uppercase">Stay home & delivered your <span class="daily">Daily
                                        Needs</span></h1>
                                <p class="w-75 d-none d-sm-block">Vegetables contain many vitamins and minerals that
                                    are
                                    good for your health.</p>
                                <button onclick="location.href = 'shop-left-sidebar.html';"
                                    class="btn btn-animation mt-xxl-4 mt-2 home-button mend-auto">Mua Ngay <i
                                        class="fa-solid fa-right-long icon"></i></button>
                            </div>
                        </div> --}}
                    </div>
                </div>

                <div class="col-xl-4 ratio_65">
                    <div class="row g-4">
                        <div class="col-xl-12 col-md-6">
                            <div class="home-contain">
                                <img src="https://cdn-media.sforum.vn/storage/app/media/1nghiatran/camera-galaxy-z-fold7.jpg"
                                    class="bg-img blur-up lazyload" alt="">
                                {{-- <div class="home-detail p-center-left home-p-sm w-75">
                                    <div>
                                        <h2 class="mt-0 text-danger">45% <span class="discount text-title">OFF</span>
                                        </h2>
                                        <h3 class="theme-color">Nut Collection</h3>
                                        <p class="w-75">We deliver organic vegetables & fruits</p>
                                        <a href="shop-left-sidebar.html" class="shop-button">Mua Ngay <i
                                                class="fa-solid fa-right-long"></i></a>
                                    </div>
                                </div> --}}
                            </div>
                        </div>

                        <div class="col-xl-12 col-md-6">
                            <div class="home-contain">
                                <img src="https://cdn-media.sforum.vn/storage/app/media/trannghia/Nubia-LiveFlip-ra-mat-cover.jpg"
                                    class="bg-img blur-up lazyload" alt="">
                                {{-- <div class="home-detail p-center-left home-p-sm w-75">
                                    <div>
                                        <h3 class="mt-0 theme-color fw-bold">Healthy Food</h3>
                                        <h4 class="text-danger">Organic Market</h4>
                                        <p class="organic">Start your daily shopping with some Organic food</p>
                                        <a href="shop-left-sidebar.html" class="shop-button">Mua Ngay <i
                                                class="fa-solid fa-right-long"></i></a>
                                    </div>
                                </div> --}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Home Section End -->

    <!-- Banner Section Start -->
    <section class="banner-section ratio_60 wow fadeInUp">
        <div class="container-fluid-lg">
            <div class="banner-slider">
                <div>
                    <div class="banner-contain hover-effect">
                        <img src="https://cdn-media.sforum.vn/storage/app/media/trannghia/beats-solo-buds-purple.jpg"
                            class="bg-img blur-up lazyload" alt="">
                        {{-- <div class="banner-details">
                            <div class="banner-box">
                                <h6 class="text-danger">5% OFF</h6>
                                <h5>Hot Deals on New Items</h5>
                                <h6 class="text-content">Daily Essentials Eggs & Dairy</h6>
                            </div>
                            <a href="shop-left-sidebar.html" class="banner-button text-white">Mua Ngay <i
                                    class="fa-solid fa-right-long ms-2"></i></a>
                        </div> --}}
                    </div>
                </div>

                <div>
                    <div class="banner-contain hover-effect">
                        <img src="https://cdn-media.sforum.vn/storage/app/media/trannghia/Insta360-Flow-2-Pro-ra-mat-1.jpg"
                            class="bg-img blur-up lazyload" alt="">
                        {{-- <div class="banner-details">
                            <div class="banner-box">
                                <h6 class="text-danger">5% OFF</h6>
                                <h5>Buy More & Save More</h5>
                                <h6 class="text-content">Fresh Vegetables</h6>
                            </div>
                            <a href="shop-left-sidebar.html" class="banner-button text-white">Mua Ngay <i
                                    class="fa-solid fa-right-long ms-2"></i></a>
                        </div> --}}
                    </div>
                </div>

                <div>
                    <div class="banner-contain hover-effect">
                        <img src="https://cdn-media.sforum.vn/storage/app/media/haianh/video-thuc-te-kinh-galaxy-xr-thumb.jpg"
                            class="bg-img blur-up lazyload" alt="">
                        {{-- <div class="banner-details">
                            <div class="banner-box">
                                <h6 class="text-danger">5% OFF</h6>
                                <h5>Organic Meat Prepared</h5>
                                <h6 class="text-content">Delivered to Your Home</h6>
                            </div>
                            <a href="shop-left-sidebar.html" class="banner-button text-white">Mua Ngay <i
                                    class="fa-solid fa-right-long ms-2"></i></a>
                        </div> --}}
                    </div>
                </div>

                <div>
                    <div class="banner-contain hover-effect">
                        <img src="https://cdn-media.sforum.vn/storage/app/media/haianh/vivo-y29s-5g-ra-mat-thumb.jpg"
                            class="bg-img blur-up lazyload" alt="">
                        {{-- <div class="banner-details">
                            <div class="banner-box">
                                <h6 class="text-danger">5% OFF</h6>
                                <h5>Buy More & Save More</h5>
                                <h6 class="text-content">Nuts & Snacks</h6>
                            </div>
                            <a href="shop-left-sidebar.html" class="banner-button text-white">Mua Ngay <i
                                    class="fa-solid fa-right-long ms-2"></i></a>
                        </div> --}}
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Banner Section End -->

    <!-- Product Section Start -->
    <section class="product-section">
        <div class="container-fluid-lg">
            <div class="row g-sm-4 g-3">
                <div class="col-xxl-3 col-xl-4 d-none d-xl-block">
                    <div class="p-sticky">
                        <div class="category-menu">
                            <h3>Danh Má»¥c</h3>


                            <ul>
                                @foreach ($categories as $category)
                                    <li>
                                        <div class="category-list">
                                            <img src="{{ Storage::url($category->icon) }}" class="blur-up lazyload"
                                                alt="">
                                            <h5>
                                                <a
                                                    href="{{ route('categories', $category->slug) }}">{{ $category->name }}</a>
                                            </h5>
                                        </div>
                                    </li>
                                @endforeach
                            </ul>

                            {{-- <ul class="value-list">
                                <li>
                                    <div class="category-list">
                                        <h5 class="ms-0 text-title">
                                            <a href="shop-left-sidebar.html">Value of the Day</a>
                                        </h5>
                                    </div>
                                </li>
                                <li>
                                    <div class="category-list">
                                        <h5 class="ms-0 text-title">
                                            <a href="shop-left-sidebar.html">Top 50 Offers</a>
                                        </h5>
                                    </div>
                                </li>
                                <li class="mb-0">
                                    <div class="category-list">
                                        <h5 class="ms-0 text-title">
                                            <a href="shop-left-sidebar.html">New Arrivals</a>
                                        </h5>
                                    </div>
                                </li>
                            </ul> --}}
                        </div>

                        <div class="ratio_156 section-t-space">
                            <div class="home-contain hover-effect">
                                <img src="https://cdn-media.sforum.vn/storage/app/media/haianh/icemag/vivo-y29s-5g-ra-mat-1.jpg"
                                    class="bg-img blur-up lazyload" alt="">
                                {{-- <div class="home-detail p-top-left home-p-medium">
                                    <div>
                                        <h6 class="text-yellow home-banner">Seafood</h6>
                                        <h3 class="text-uppercase fw-normal"><span
                                                class="theme-color fw-bold">Freshes</span> Products</h3>
                                        <h3 class="fw-light">every hour</h3>
                                        <button onclick="location.href = 'shop-left-sidebar.html';"
                                            class="btn btn-animation btn-md mend-auto">Mua Ngay <i
                                                class="fa-solid fa-arrow-right icon"></i></button>
                                    </div>
                                </div> --}}
                            </div>
                        </div>

                        <div class="ratio_medium section-t-space">
                            <div class="home-contain hover-effect">
                                <img src="https://cdn-media.sforum.vn/storage/app/media/trannghia/ROG-Flow-Z13-civer.jpg"
                                    class="img-fluid blur-up lazyload" alt="">
                                {{-- <div class="home-detail p-top-left home-p-medium">
                                    <div>
                                        <h4 class="text-yellow text-exo home-banner">Organic</h4>
                                        <h2 class="text-uppercase fw-normal mb-0 text-russo theme-color">fresh</h2>
                                        <h2 class="text-uppercase fw-normal text-title">Vegetables</h2>
                                        <p class="mb-3">Super Offer to 50% Off</p>
                                        <button onclick="location.href = 'shop-left-sidebar.html';"
                                            class="btn btn-animation btn-md mend-auto">Mua Ngay <i
                                                class="fa-solid fa-arrow-right icon"></i></button>
                                    </div>
                                </div> --}}
                            </div>
                        </div>

                        <div class="section-t-space">
                            <div class="category-menu">
                                <h3>Sáº£n Pháº©m HÃ³t</h3>

                                <ul class="product-list border-0 p-0 d-block">

                                    @foreach ($trendingProducts->take(10) as $trendingProduct)
                                        <li>
                                            <div class="offer-product">
                                                <a href="{{ route('products', ['product' => $trendingProduct->slug]) }}"
                                                    class="offer-image">
                                                    <img src="{{ Storage::url($trendingProduct->thumbnail) }}"
                                                        class="blur-up lazyload" alt="">
                                                </a>

                                                <div class="offer-detail">
                                                    <div>
                                                        <a href="{{ route('products', ['product' => $trendingProduct->slug]) }}"
                                                            class="text-title">
                                                            <h6 class="name">{{ $trendingProduct->name }}</h6>
                                                        </a>
                                                        <span>LÆ°á»£t Xem: {{ $trendingProduct->views }}</span>
                                                        <h5 class="price">
                                                            <span
                                                                class="theme-color">{{ number_format($trendingProduct->display_price) }}Ä</span>
                                                            {{-- Kiá»m tra is_sale thay vÃ¬ sale_price --}}
                                                            @if ($trendingProduct->is_sale == 1)
                                                                <del>{{ number_format($trendingProduct->original_price) }}Ä</del>
                                                            @endif
                                                        </h5>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    @endforeach

                                </ul>
                            </div>
                        </div>

                        {{-- <div class="section-t-space">
                            <div class="category-menu">
                                <h3>Customer Comment</h3>

                                <div class="review-box">
                                    <div class="review-contain">
                                        <h5 class="w-75">We Care About Our Customer Experience</h5>
                                        <p>In publishing and graphic design, Lorem ipsum is a placeholder text commonly
                                            used to demonstrate the visual form of a document or a typeface without
                                            relying on meaningful content.</p>
                                    </div>

                                    <div class="review-profile">
                                        <div class="review-image">
                                            <img src="{{ asset('theme/client/assets/images/product/vendor.png') }}"
                                                class="img-fluid blur-up lazyload" alt="">
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div> --}}
                    </div>
                </div>

                <div class="col-xxl-9 col-xl-8">
                    <div class="title title-flex">
                        <div>
                            <h2>CÃ¡c sáº£n pháº©m bÃ¡n cháº¡y nháº¥t hÃ´m nay.</h2>
                            <p></p>
                        </div>

                    </div>

                    <div class="section-b-space">
                        <div class="product-border  overflow-hidden">
                            <div>
                                <div class="row gx-3 gy-4">
                                    @foreach ($bestSellProductsToday as $topSell)
                                        <div class="col-lg-3 col-md-4 col-sm-6 ">
                                            <div class="product-box border rounded shadow-sm p-3">
                                                <div class="product-image">
                                                    <a href="{{ route('products', ['product' => $topSell->slug]) }}">
                                                        <img src="{{ Storage::url($topSell->thumbnail) }}"
                                                            class="img-fluid blur-up lazyload" alt="">
                                                    </a>
                                                    <ul class="product-option">
                                                        <li data-bs-toggle="tooltip" data-bs-placement="top" title="View">
                                                            <a href="javascript:void(0)" data-bs-toggle="modal"
                                                                data-bs-target="#view" data-id={{ $topSell->id }}
                                                                data-slug="{{ $topSell->slug }}">
                                                                <i data-feather="eye"></i>
                                                            </a>
                                                        </li>

                                                        <li data-bs-toggle="tooltip" data-bs-placement="top"
                                                            title="So sÃ¡nh">
                                                            <a href="javascript:;" class="compare-toggle"
                                                                data-state="unselected"
                                                                data-product-id="{{ $topSell->id }}"
                                                                data-product-category-id="{{ $topSell->categories->first()->id ?? null }}">
                                                                <span class="icon-refresh">
                                                                    <i data-feather="refresh-cw"></i>
                                                                </span>
                                                                <span class="icon-check" style="display:none;">
                                                                    <i data-feather="check"></i>
                                                                </span>
                                                            </a>
                                                        </li>

                                                        <li data-bs-toggle="tooltip" data-bs-placement="top"
                                                            title="Wishlist">
                                                            <a href="javascript:void(0);"
                                                                class="notifi-wishlist wishlist-toggle"
                                                                data-product-id="{{ $topSell->id }}">
                                                                <i data-feather="heart" class="wishlist-icon"
                                                                    style="color: {{ in_array($topSell->id, $wishlistProductIds) ? 'red' : 'black' }};"></i>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="product-detail">
                                                    <a href="{{ route('products', ['product' => $topSell->slug]) }}">
                                                        <h6 class="name">{{ $topSell->name }}</h6>
                                                    </a>

                                                    <h5 class="price">
                                                        <span
                                                            class="theme-color">{{ number_format($topSell->display_price) }}Ä</span>
                                                        {{-- Kiá»m tra is_sale thay vÃ¬ sale_price --}}
                                                        @if ($topSell->is_sale == 1)
                                                            <del>{{ number_format($topSell->original_price) }}Ä</del>
                                                        @endif
                                                    </h5>


                                                    <div class="product-rating mt-sm-2 mt-1">
                                                        <ul class="rating">
                                                            @for ($i = 1; $i <= 5; $i++)
                                                                <li>
                                                                    <i data-feather="star"
                                                                        class="{{ $i <= round($topSell->average_rating) ? 'fill' : '' }}"></i>
                                                                </li>
                                                            @endfor
                                                        </ul>
                                                        <span
                                                            class="text-muted ms-2">({{ number_format($topSell->average_rating, 1) }})</span>
                                                    </div>
                                                    <div class="d-flex justify-content-between mt-sm-2 mt-1">
                                                        <h6 class="unit">LÆ°á»£t xem: {{ $topSell->views }}</h6>
                                                        <h6 class="unit">ÄÃ£ BÃ¡n HÃ´m Nay: {{ $topSell->total_sold }}</h6>
                                                    </div>
                                                    <div class="add-to-cart-box">
                                                        <a href="javascript:void(0)" data-bs-toggle="modal"
                                                            data-bs-target="#view" data-id={{ $topSell->id }}
                                                            data-slug="{{ $topSell->slug }}"
                                                            class="btn btn-add-cart addcart-button">
                                                            ThÃªm vÃ o giá» hÃ ng
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    @endforeach

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="title">
                        <h2>CÃ¡c danh má»¥c ná»i báº­t hÃ ng Äáº§u cá»§a tuáº§n.</h2>
                    </div>

                    <div class="category-slider-2 product-wrapper no-arrow">
                        @foreach ($topCategoriesInweek as $topCategory)
                            <div>
                                <a href="{{ route('categories', $topCategory->slug) }}"
                                    class="category-box category-dark">
                                    <div>
                                        <img src="{{ Storage::url($topCategory->icon) }}" class="blur-up lazyload"
                                            alt="">
                                        <h5>{{ $topCategory->name }}</h5>
                                    </div>
                                </a>
                            </div>
                        @endforeach
                    </div>

                    <div class="section-t-space section-b-space">
                        <div class="row g-md-4 g-3">
                            <div class="col-md-6">
                                <div class="banner-contain hover-effect">
                                    <img src="{{ asset('theme/client/assets/images/product/image2.png') }}"
                                        class="bg-img blur-up lazyload" alt="">

                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="banner-contain hover-effect">
                                    <img src="{{ asset('theme/client/assets/images/product/image1.png') }}"
                                        class="bg-img blur-up lazyload" alt="">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="title d-block">
                        <h2>Sáº£n pháº©m dÃ nh cho báº¡n.</h2>
                        <p></p>
                    </div>

                    <div class="section-b-space">
                        <div class="product-border  overflow-hidden">
                            <div>
                                <div class="row gx-3 gy-4">
                                    @foreach ($aiSuggestedProducts as $aiSuggest)
                                        <div class="col-lg-3 col-md-4 col-sm-6 ">
                                            <div class="product-box border rounded shadow-sm p-3">
                                                <div class="product-image">
                                                    <a href="{{ route('products', ['product' => $aiSuggest->slug]) }}">
                                                        <img src="{{ Storage::url($aiSuggest->thumbnail) }}"
                                                            class="img-fluid blur-up lazyload" alt="">
                                                    </a>
                                                    <ul class="product-option">
                                                        <li data-bs-toggle="tooltip" data-bs-placement="top" title="View">
                                                            <a href="javascript:void(0)" data-bs-toggle="modal"
                                                                data-bs-target="#view" data-id={{ $aiSuggest->id }}
                                                                data-slug="{{ $aiSuggest->slug }}">
                                                                <i data-feather="eye"></i>
                                                            </a>
                                                        </li>

                                                        <li data-bs-toggle="tooltip" data-bs-placement="top"
                                                            title="So sÃ¡nh">
                                                            <a href="javascript:;" class="compare-toggle"
                                                                data-state="unselected"
                                                                data-product-id="{{ $aiSuggest->id }}"
                                                                data-product-category-id="{{ $aiSuggest->categories->first()->id ?? null }}">
                                                                <span class="icon-refresh">
                                                                    <i data-feather="refresh-cw"></i>
                                                                </span>
                                                                <span class="icon-check" style="display:none;">
                                                                    <i data-feather="check"></i>
                                                                </span>
                                                            </a>
                                                        </li>

                                                        <li data-bs-toggle="tooltip" data-bs-placement="top"
                                                            title="Wishlist">
                                                            <a href="javascript:void(0);"
                                                                class="notifi-wishlist wishlist-toggle"
                                                                data-product-id="{{ $aiSuggest->id }}">
                                                                <i data-feather="heart" class="wishlist-icon"
                                                                    style="color: {{ in_array($aiSuggest->id, $wishlistProductIds) ? 'red' : 'black' }};"></i>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="product-detail">
                                                    <a href="{{ route('products', ['product' => $aiSuggest->slug]) }}">
                                                        <h6 class="name">{{ $aiSuggest->name }}</h6>
                                                    </a>

                                                    <h5 class="price">
                                                        <span
                                                            class="theme-color">{{ number_format($aiSuggest->display_price) }}Ä</span>
                                                        {{-- Kiá»m tra is_sale thay vÃ¬ sale_price --}}
                                                        @if ($aiSuggest->is_sale == 1)
                                                            <del>{{ number_format($aiSuggest->original_price) }}Ä</del>
                                                        @endif
                                                    </h5>


                                                    <div class="product-rating mt-sm-2 mt-1">
                                                        <ul class="rating">
                                                            @for ($i = 1; $i <= 5; $i++)
                                                                <li>
                                                                    <i data-feather="star"
                                                                        class="{{ $i <= round($aiSuggest->average_rating) ? 'fill text-warning' : '' }}"></i>
                                                                </li>
                                                            @endfor
                                                        </ul>
                                                        <span
                                                            class="text-muted ms-2">({{ number_format($aiSuggest->average_rating, 1) }})</span>
                                                    </div>

                                                    <div class="d-flex justify-content-between mt-sm-2 mt-1">
                                                        <h6 class="unit">LÆ°á»£t xem: {{ $aiSuggest->views}}</h6>

                                                        @if (isset($aiSuggest->total_sold))
                                                            <h6 class="unit">ÄÃ£ BÃ¡n: {{ $aiSuggest->total_sold }}</h6>
                                                        @endif
                                                    </div>

                                                    <div class="add-to-cart-box">
                                                        <a href="javascript:void(0)" data-bs-toggle="modal"
                                                            data-bs-target="#view" data-id={{ $aiSuggest->id }}
                                                            data-slug={{ $aiSuggest->slug }}
                                                            class="btn btn-add-cart addcart-button">
                                                            ThÃªm vÃ o giá» hÃ ng
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    @endforeach
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="title d-block">
                        <h2>Sáº£n pháº©m Ná»i báº­t.</h2>
                        <p></p>
                    </div>
                    <div class="section-b-space">
                        <div class="product-border  overflow-hidden">
                            <div>
                                <div class="row gx-3 gy-4">
                                    @foreach ($productForYou as $fouYou)
                                        <div class="col-lg-3 col-md-4 col-sm-6 ">
                                            <div class="product-box border rounded shadow-sm p-3">
                                                <div class="product-image">
                                                    <a href="{{ route('products', ['product' => $fouYou->slug]) }}">
                                                        <img src="{{ Storage::url($fouYou->thumbnail) }}"
                                                            class="img-fluid blur-up lazyload" alt="">
                                                    </a>
                                                    <ul class="product-option">
                                                        <li data-bs-toggle="tooltip" data-bs-placement="top" title="View">
                                                            <a href="javascript:void(0)" data-bs-toggle="modal"
                                                                data-bs-target="#view" data-id={{ $fouYou->id }}
                                                                data-slug="{{ $fouYou->slug }}">
                                                                <i data-feather="eye"></i>
                                                            </a>
                                                        </li>

                                                        <li data-bs-toggle="tooltip" data-bs-placement="top"
                                                            title="So sÃ¡nh">
                                                            <a href="javascript:;" class="compare-toggle"
                                                                data-state="unselected"
                                                                data-product-id="{{ $fouYou->id }}"
                                                                data-product-category-id="{{ $fouYou->categories->first()->id ?? null }}">
                                                                <span class="icon-refresh">
                                                                    <i data-feather="refresh-cw"></i>
                                                                </span>
                                                                <span class="icon-check" style="display:none;">
                                                                    <i data-feather="check"></i>
                                                                </span>
                                                            </a>
                                                        </li>

                                                        <li data-bs-toggle="tooltip" data-bs-placement="top"
                                                            title="Wishlist">
                                                            <a href="javascript:void(0);"
                                                                class="notifi-wishlist wishlist-toggle"
                                                                data-product-id="{{ $fouYou->id }}">
                                                                <i data-feather="heart" class="wishlist-icon"
                                                                    style="color: {{ in_array($fouYou->id, $wishlistProductIds) ? 'red' : 'black' }};"></i>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="product-detail">
                                                    <a href="{{ route('products', ['product' => $fouYou->slug]) }}">
                                                        <h6 class="name">{{ $fouYou->name }}</h6>
                                                    </a>

                                                    <h5 class="price">
                                                        @if ($fouYou->is_sale == 1 && $fouYou->display_price < $fouYou->original_price)
                                                            <span class="theme-color">{{ number_format($fouYou->display_price) }}Ä</span>
                                                            <del>{{ number_format($fouYou->original_price) }}Ä</del>
                                                        @else
                                                            <span class="theme-color">{{ number_format($fouYou->original_price) }}Ä</span>
                                                        @endif
                                                    </h5>                                                    
                                                    <div class="product-rating mt-sm-2 mt-1">
                                                        <ul class="rating">
                                                            @for ($i = 1; $i <= 5; $i++)
                                                                <li>
                                                                    <i data-feather="star"
                                                                        class="{{ $i <= round($fouYou->average_rating) ? 'fill text-warning' : '' }}"></i>
                                                                </li>
                                                            @endfor
                                                        </ul>
                                                        <span
                                                            class="text-muted ms-2">({{ number_format($fouYou->average_rating, 1) }})</span>
                                                    </div>

                                                    <div class="d-flex justify-content-between mt-sm-2 mt-1">
                                                        <h6 class="unit">LÆ°á»£t xem: {{ $fouYou->views }}</h6>

                                                        @if (isset($fouYou->total_sold))
                                                            <h6 class="unit">ÄÃ£ BÃ¡n: {{ $fouYou->total_sold }}</h6>
                                                        @endif
                                                    </div>
                                                    <div class="add-to-cart-box">
                                                        <a href="javascript:void(0)" data-bs-toggle="modal"
                                                            data-bs-target="#view" data-id={{ $fouYou->id }}
                                                            data-slug={{ $fouYou->slug }}
                                                            class="btn btn-add-cart addcart-button">
                                                            ThÃªm vÃ o giá» hÃ ng
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    @endforeach
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="title d-block">
                        <div>
                            <h2>Sáº£n pháº©m bÃ¡n cháº¡y nháº¥t cá»§a chÃºng tÃ´i</h2>
                        </div>
                    </div>
                    <div class="best-selling-slider product-wrapper wow fadeInUp">
                        @foreach ($bestSellingProducts->chunk(4) as $chunk)
                            <div>
                                <ul class="product-list">
                                    @foreach ($chunk as $product)
                                        <li>
                                            <div class="offer-product">
                                                <a href="{{ route('products', ['product' => $product->slug]) }}"
                                                    class="offer-image">
                                                    <img src="{{ Storage::url($product->thumbnail) }}" class="blur-up lazyload"
                                                        alt="{{ $product->name }}">
                                                </a>

                                                <div class="offer-detail">
                                                    <div>
                                                        <a href="{{ route('products', ['product' => $product->slug]) }}"
                                                            class="text-title">
                                                            <h6 class="name">{{ $product->name }}</h6>
                                                        </a>
                                                        <span>{{ $product->total_sold }} ÄÃ£ bÃ¡n</span>
                                                        <h5 class="price">
                                                            <span
                                                                class="theme-color">{{ number_format($product->display_price) }}Ä</span>
                                                            {{-- Kiá»m tra is_sale thay vÃ¬ sale_price --}}
                                                            @if ($product->is_sale == 1)
                                                                <del>{{ number_format($product->original_price) }}Ä</del>
                                                            @endif
                                                        </h5>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    @endforeach
                                </ul>
                            </div>
                        @endforeach
                    </div>

                    <div class="section-t-space">
                        <div class="banner-contain hover-effect">
                            <img src="{{ asset('theme/client/assets/images/product/vendor.png') }}"
                                class="bg-img blur-up lazyload" alt="">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Product Section End -->

    <!-- Newsletter Section Start -->
    <section class="newsletter-section section-b-space">
        <div class="container-fluid-lg">
            <div class="newsletter-box newsletter-box-2">
                <div class="newsletter-contain py-5">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-xxl-4 col-lg-5 col-md-7 col-sm-9 offset-xxl-2 offset-md-1">
                                <div class="newsletter-detail">
                                    <h2>Join our newsletter and get...</h2>
                                    <h5>$20 discount for your first order</h5>
                                    <div class="input-box">
                                        <input type="email" class="form-control" id="exampleFormControlInput1"
                                            placeholder="Enter Your Email">
                                        <i class="fa-solid fa-envelope arrow"></i>
                                        <button class="sub-btn  btn-animation">
                                            <span class="d-sm-block d-none">Subscribe</span>
                                            <i class="fa-solid fa-arrow-right icon"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Newsletter Section End -->
@endsection

@section('modal')
    <!-- Quick View Modal Box Start -->
    <div class="modal fade theme-modal view-modal" id="view" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-sm-down">
            <div class="modal-content">
                <div class="modal-header p-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row g-sm-4 g-2" id="productDetails">
                        <div class="col-lg-6">
                            <div class="slider-image">
                                <img id="prdThumbnail" src="" class="img-fluid blur-up lazyload" alt="">
                            </div>
                        </div>

                        <div class="col-lg-6">
                            <div class="right-sidebar-modal">
                                <h4 class="title-name" id='prdName'></h4>
                                <h4 class="price" id='prdPrice'></h4>
                                <div class="product-rating" id="prdRating">
                                    <ul class="rating">

                                    </ul>
                                    {{-- <span class="ms-2">8 Reviews</span> --}}
                                    <span class="ms-2 text-danger" id="prdSoldCount"></span>
                                </div>

                                <div class="product-stock">
                                    <span> </span>
                                </div>

                                <div class="product-detail">
                                    <h4>MÃ´ táº£ sáº£n pháº©m :</h4>
                                    <p id='prdDescription'></p>
                                </div>

                                <ul class="brand-list">
                                    <li>
                                        <div class="brand-box">
                                            <h5>ThÆ°Æ¡ng Hiá»u:</h5>
                                            <h6 id = 'prdBrand'></h6>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="brand-box">
                                            <h5>Danh Má»¥c:</h5>
                                            <h6 id="prdCategories"></h6>
                                        </div>
                                    </li>
                                </ul>

                                <div id="productVariants">

                                </div>

                                <div class="modal-button">
                                    <form id="addToCartForm" method="POST" action="{{ route('cart.add') }}">
                                        @csrf
                                        <input type="hidden" name="product_id" id="cartProductId">
                                        <input type="hidden" name="product_variant_id" id="cartProductVariantId">
                                        <input type="hidden" id="isUserLoggedIn" value="{{ auth()->check() ? '1' : '0' }}">
                                        <input type="hidden" name="quantity" value="1">
                                        <button type="submit" class="btn btn-md add-cart-button icon">ThÃªm VÃ o giá»
                                            hÃ ng</button>
                                    </form>
                                    <button
                                        class="btn theme-bg-color view-button icon text-white fw-bold btn-md detail-product-button"
                                        data-product-id="">
                                        Xem chi tiáº¿t sáº£n pháº©m
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Quick View Modal Box End -->
@endsection
@push('js')
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // HÃ m Äá»nh dáº¡ng giÃ¡ tiá»n sang VNÄ
        function formatPrice(price) {
            const number = parseFloat(price) // Chuyá»n Äá»i giÃ¡ sang sá» thá»±c
            return isNaN(number) ? "0 Ä" : number.toLocaleString('vi-VN', { // Äá»nh dáº¡ng sá» sang VNÄ
                style: 'currency',
                currency: 'VND'
            })
        }
        // sá»­a láº¡i script Äá» phÃ¹ há»£p vá»i lÃ m giá» hÃ ng

        $(document).ready(function() {
            @if (session('success'))
                Swal.fire({
                    icon: 'success',
                    title: 'ThÃ nh cÃ´ng!',
                    text: "{{ session('success') }}",
                    timer: 1500,
                    showConfirmButton: true
                });
            @endif

            @if (session('error'))
                Swal.fire({
                    icon: 'error',
                    title: 'Lá»i!',
                    text: "{{ session('error') }}",
                    showConfirmButton: true
                });
            @endif

            // Khai bÃ¡o biáº¿n toÃ n cá»¥c Äá» lÆ°u trá»¯ variantMap
            let globalVariantMap = {};

            $('a[data-bs-target="#view"]').click(function() {
                const productId = $(this).data('id');
                const productSlug = $(this).data('slug');

                $('#view').data('product-id', productId);
                $('#view').data('product-slug', productSlug);
                $('#cartProductId').val(productId);

                $.ajax({
                    url: '/api/product/' + productId,
                    method: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        // Cáº­p nháº­t thÃ´ng tin cÆ¡ báº£n cá»§a sáº£n pháº©m
                        $('#prdName').text(response.name);
                        $('#prdDescription').html(response.short_description);
                        $('#prdBrand').text(response.brand);
                        $('#prdCategories').text(response.categories);

                        // Xá»­ lÃ½ rating
                        const avgRating = response.avgRating || 0;
                        $('#prdRating ul.rating').html(
                            Array.from({
                                    length: 5
                                }, (_, i) =>
                                `<li><i data-feather="star" class="${i < avgRating ? 'fill' : ''}"></i></li>`
                            ).join('')
                        );
                        feather.replace();

                        // ÄÃ£ bÃ¡n
                        $('#prdSoldCount').text(`ÄÃ£ bÃ¡n (${response.sold_count})`);

                        // Xá»­ lÃ½ biáº¿n thá» sáº£n pháº©m
                        const variants = response.productVariants || [];
                        console.log("response.productVariants from service:", response
                            .productVariants); // In ra toÃ n bá» máº£ng productVariants

                        $('#productVariants').empty();

                        // Lá»c cÃ¡c biáº¿n thá» active
                        const activeVariants = variants.filter(variant => variant.is_active ===
                            1);

                        if (activeVariants.length > 0) {
                            // Cáº­p nháº­t globalVariantMap vá»i cÃ¡c biáº¿n thá» active
                            activeVariants.forEach(variant => {
                                const key = variant.attribute_values
                                    .map(attr => attr.id)
                                    .sort((a, b) => a - b)
                                    .join('-');
                                globalVariantMap[key] = {
                                    id: variant.id,
                                    price: variant.price,
                                    thumbnail: variant.thumbnail,
                                    product_stock: variant.product_stock,
                                    is_sale: variant.is_sale || 0,
                                    sale_price: variant.sale_price || 0,
                                    display_price: variant.display_price || variant
                                        .price,
                                    original_price: variant.original_price ||
                                        variant.price,
                                    sold_count: variant.sold_count,
                                };
                            });
                            console.log("Global Variant Map updated:", globalVariantMap);

                            // Táº¡o map thuá»c tÃ­nh tá»« cÃ¡c biáº¿n thá» active
                            const attributes = {};
                            activeVariants.forEach(variant => {
                                variant.attribute_values.forEach(attr => {
                                    const attrSlug = attr.attributes_slug;
                                    if (!attributes[attrSlug]) {
                                        attributes[attrSlug] = new Map();
                                    }
                                    attributes[attrSlug].set(attr.id, attr
                                        .attribute_value);
                                });
                            });

                            // Táº¡o HTML cho dropdown thuá»c tÃ­nh
                            let attributesHtml = '';
                            Object.entries(attributes).forEach(([attrSlug, valuesMap]) => {
                                let sampleAttrValue = activeVariants.reduce((found,
                                    variant) => {
                                    return found || variant.attribute_values
                                        .find(av => av.attributes_slug ===
                                            attrSlug);
                                }, null);

                                attributesHtml += `
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>${sampleAttrValue ? sampleAttrValue.attributes_name : attrSlug.split('-').join(' ')}</label>
                                            <select class="form-control variant-attribute" data-attribute="${attrSlug}">
                                                ${Array.from(valuesMap).map(([id, value]) =>
                                                    `<option value="${id}">${value}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                    </div>
                                `;
                            });
                            $('#productVariants').html(
                                `<div class="row">${attributesHtml}</div>`);

                            // TÃ¬m biáº¿n thá» giÃ¡ tháº¥p nháº¥t tá»« activeVariants
                            const lowestVariant = activeVariants.reduce((prev, curr) => {
                                const prevDisplayPrice = prev.is_sale && prev
                                    .display_price ? prev.display_price : prev
                                    .original_price;
                                const currDisplayPrice = curr.is_sale && curr
                                    .display_price ? curr.display_price : curr
                                    .original_price;
                                return parseFloat(prevDisplayPrice) < parseFloat(
                                    currDisplayPrice) ? prev : curr;
                            });

                            // Cáº­p nháº­t thÃ´ng tin ban Äáº§u
                            updateProductInfo(lowestVariant, response.is_sale);
                            setSelectedAttributes(lowestVariant.attribute_values);
                            updateStockInfo(lowestVariant);
                            $('#cartProductVariantId').val(lowestVariant.id);

                            // Xá»­ lÃ½ sá»± kiá»n thay Äá»i dropdown
                            $('.variant-attribute').change(function() {
                                const selectedValues = getSelectedAttributes();
                                const variantKey = selectedValues.sort((a, b) => a - b)
                                    .join('-');
                                const variant = globalVariantMap[variantKey];
                                // **THÃM console.log Äá» KIá»M TRA variant TRONG CHANGE EVENT**
                                console.log("change event - variantKey:",
                                    variantKey); // In ra variantKey
                                console.log("change event - variant:",
                                    variant); // In ra object variant tÃ¬m ÄÆ°á»£c
                                if (variant) {
                                    $('#cartProductVariantId').val(variant.id);
                                    updateProductInfo(variant, response.is_sale);
                                    updateStockInfo(variant);
                                    // **XOÃ thÃ´ng bÃ¡o lá»i (náº¿u cÃ³) khi tÃ¬m tháº¥y variant**
                                    $('#variant-not-found-message')
                                        .hide(); // áº¨n thÃ´ng bÃ¡o lá»i
                                } else {
                                    console.log("KhÃ´ng tÃ¬m tháº¥y biáº¿n thá» cho key:",
                                        variantKey);
                                    $('#cartProductVariantId').val('');
                                    // **HIá»N THá» thÃ´ng bÃ¡o lá»i khi khÃ´ng tÃ¬m tháº¥y variant**
                                    $('#prdPrice').html(
                                        '<p class="text-danger" id="variant-not-found-message">Biáº¿n thá» khÃ´ng cÃ³ sáºµn</p>'
                                    ); // Hiá»n thá» thÃ´ng bÃ¡o lá»i á» khu vá»±c giÃ¡
                                    $('.product-stock span').text(
                                        ''); // XÃ³a thÃ´ng tin kho
                                    $('#prdSoldCount').text(''); // XÃ³a thÃ´ng tin ÄÃ£ bÃ¡n
                                }
                            });
                        } else {
                            // Xá»­ lÃ½ khi khÃ´ng cÃ³ biáº¿n thá» active
                            let priceHtml;
                            if (response.is_sale && response.display_price) {
                                priceHtml =
                                    `${formatPrice(response.display_price)} <small><del>${formatPrice(response.original_price)}</del></small>`;
                            } else {
                                priceHtml = formatPrice(response.original_price || 0);
                            }
                            $('#prdPrice').html(priceHtml);
                            $('#prdThumbnail').attr('src', response.thumbnail ||
                                '/path/to/default-image.jpg');
                            $('.product-stock span').text(`Kho: ${response.stock || 0}`);
                            $('#cartProductVariantId').val('');
                        }
                    },
                    error: () => alert('KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m')
                });
            });

            // view detial product
            $('.detail-product-button').click(function() {
                const productSlug = $('#view').data('product-slug');

                if (productSlug) {
                    const productDetailUrl = "{{ route('products', ['product' => ':slug']) }}".replace(
                        ':slug', productSlug);
                    location.href = productDetailUrl;
                } else {
                    console.error(
                        "KhÃ´ng tÃ¬m tháº¥y productSlug Äá» chuyá»n hÆ°á»ng Äáº¿n trang chi tiáº¿t sáº£n pháº©m.");
                    alert(
                        "Lá»i: KhÃ´ng thá» chuyá»n Äáº¿n trang chi tiáº¿t sáº£n pháº©m. KhÃ´ng tÃ¬m tháº¥y Slug sáº£n pháº©m."
                    );
                }
            });

            // HÃ m cáº­p nháº­t giÃ¡ vÃ  thumbnail
            function updateProductInfo(variant, isSale) {
                let priceHtml;
                const isVariantOnSale = isSale && variant.display_price && variant.original_price && parseFloat(
                    variant.display_price) < parseFloat(variant.original_price);
                if (isVariantOnSale) {
                    priceHtml =
                        `${formatPrice(variant.display_price)} <small><del>${formatPrice(variant.original_price)}</del></small>`;
                } else {
                    priceHtml = formatPrice(variant.original_price || 0);
                }
                $('#prdPrice').html(priceHtml);
                $('#prdThumbnail').attr('src', variant.thumbnail);
            }

            // HÃ m chá»n giÃ¡ trá» thuá»c tÃ­nh trong dropdown
            function setSelectedAttributes(attributes) {
                attributes.forEach(attr => {
                    const attrSlug = attr.attributes_slug;
                    $(`select[data-attribute="${attrSlug}"]`).val(attr.id);
                });
            }

            // HÃ m láº¥y cÃ¡c giÃ¡ trá» thuá»c tÃ­nh ÄÃ£ chá»n
            function getSelectedAttributes() {
                const selected = [];
                $('.variant-attribute').each(function() {
                    const val = $(this).val();
                    if (val) selected.push(val);
                });
                return selected;
            }

            // HÃ m cáº­p nháº­t thÃ´ng tin kho
            function updateStockInfo(variant) {
                if (variant) { // **KIá»M TRA variant CÃ Tá»N Táº I**
                    const stock = variant.product_stock ? variant.product_stock.stock : 0;
                    $('.product-stock span').text(`Kho: ${stock}`);
                    // **THÃM console.log Äá» KIá»M TRA variant.sold_count**
                    console.log("updateStockInfo - variant:", variant); // In ra toÃ n bá» object variant
                    console.log("updateStockInfo - variant.sold_count:", variant
                        .sold_count); // In ra giÃ¡ trá» sold_count
                    $('#prdSoldCount').text(`ÄÃ£ bÃ¡n biáº¿n thá» (${variant.sold_count || 0})`);
                } else {
                    $('.product-stock span').text(''); // XÃ³a thÃ´ng tin kho khi khÃ´ng cÃ³ variant
                    $('#prdSoldCount').text(''); // XÃ³a thÃ´ng tin ÄÃ£ bÃ¡n khi khÃ´ng cÃ³ variant
                }
            }

            // ThÃªm vÃ o giá» hÃ ng
            $('.add-cart-button').click(function() {
                const productId = $('#view').data('product-id');
                const hasVariants = $('#productVariants .variant-attribute').length > 0;
                let cartData;

                if (hasVariants) {
                    const selectedValues = getSelectedAttributes();
                    const variantKey = selectedValues.sort((a, b) => a - b).join('-');
                    const selectedVariant = globalVariantMap[variantKey];
                    if (!selectedVariant) {
                        alert('Vui lÃ²ng chá»n Äáº§y Äá»§ thuá»c tÃ­nh sáº£n pháº©m');
                        return;
                    }
                    cartData = {
                        product_id: productId,
                        product_variant_id: selectedVariant.id,
                        quantity: 1
                    };
                } else {
                    cartData = {
                        product_id: productId,
                        quantity: 1
                    };
                }
                this.submit();
            }); // end modal-addToCard

            // comrpert
            // comapre cookie
            const compareCookieName = 'compare_list'; // TÃªn cookie Äá» lÆ°u danh sÃ¡ch so sÃ¡nh

            // HÃ m láº¥y cookie theo tÃªn
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.startsWith(name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            // HÃ m set cookie
            function setCookie(name, value, days) {
                var expires = "";
                if (days) {
                    var date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = "; expires=" + date.toUTCString();
                }
                document.cookie = name + "=" + (value || "") + expires + "; path=/";
            }

            // HÃ m xÃ³a cookie
            function deleteCookie(name) {
                document.cookie = name + '=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;';
            }

            // HÃ m láº¥y danh sÃ¡ch sáº£n pháº©m so sÃ¡nh tá»« cookie
            function getCompareListFromCookie() {
                let compareListCookie = getCookie(compareCookieName);
                return compareListCookie ? JSON.parse(compareListCookie) : [];
            }

            // HÃ m thÃªm sáº£n pháº©m vÃ o so sÃ¡nh (lÆ°u vÃ o cookie)
            function addProductToCompareCookie(productId) {
                let compareListCookie = getCookie(compareCookieName);
                let compareList = compareListCookie ? JSON.parse(compareListCookie) : [];

                if (!compareList.includes(productId)) { // Kiá»m tra sáº£n pháº©m ÄÃ£ cÃ³ trong list chÆ°a
                    compareList.push(productId); // ThÃªm sáº£n pháº©m vÃ o list
                    setCookie(compareCookieName, JSON.stringify(compareList),
                        30); // LÆ°u láº¡i vÃ o cookie (JSON string, háº¿t háº¡n sau 30 ngÃ y)
                    updateCompareCountBadgeCookie(); // Cáº­p nháº­t badge sá» lÆ°á»£ng
                }
            }

            // HÃ m xÃ³a sáº£n pháº©m khá»i so sÃ¡nh (xÃ³a khá»i cookie)
            function removeFromCompareCookie(
                productId
            ) {
                let compareListCookie = getCookie(compareCookieName);
                let compareList = compareListCookie ? JSON.parse(compareListCookie) : [];
                const index = compareList.indexOf(productId);
                if (index > -1) {
                    compareList.splice(index, 1); // XÃ³a sáº£n pháº©m khá»i list
                    setCookie(compareCookieName, JSON.stringify(compareList), 30); // LÆ°u láº¡i vÃ o cookie
                    updateCompareCountBadgeCookie(); // Cáº­p nháº­t badge sá» lÆ°á»£ng
                    updateCompareButtonStatus(productId, false); // Cáº­p nháº­t tráº¡ng thÃ¡i nÃºt (icon)
                }
            }

            // HÃ m cáº­p nháº­t badge sá» lÆ°á»£ng sáº£n pháº©m so sÃ¡nh (dÃ¹ng jQuery)
            function updateCompareCountBadgeCookie() {
                const compareCount = getCompareListFromCookie().length; // Äáº¿m sá» lÆ°á»£ng tá»« cookie
                $('.header-compare .badge-compare').text(compareCount); // Cáº­p nháº­t text badge
                if (compareCount > 0) {
                    $('.header-compare .badge-compare').show(); // Hiá»n thá» badge náº¿u cÃ³ sáº£n pháº©m
                } else {
                    $('.header-compare .badge-compare').hide(); // áº¨n badge náº¿u khÃ´ng cÃ³ sáº£n pháº©m
                }
            }


            function updateCompareCount() {
                updateCompareCountBadgeCookie(); // Gá»I HÃM Cáº¬P NHáº¬T BADGE Dá»°A TRÃN COOKIE TRá»°C TIáº¾P
            }


            function updateCompareButtonStatus(productId, isCompared) {
                var compareButton = $('.compare-toggle[data-product-id="' + productId + '"]');
                if (compareButton.length) {
                    console.log(`[updateCompareButtonStatus] productId: ${productId}, isCompared: ${isCompared}`);
                    console.log(
                        `  Before update: data-state: ${compareButton.attr('data-state')}, icon-refresh visible: ${compareButton.find('.icon-refresh').is(':visible')}, icon-check visible: ${compareButton.find('.icon-check').is(':visible')}`
                    );
                    if (isCompared) {
                        compareButton.find('.icon-refresh').hide();
                        compareButton.find('.icon-check').show();
                        // **CHá»NH Sá»¬A: DIRECT DOM MANIPULATION - SET data-state**
                        compareButton[0].dataset.state = 'selected'; // Sá»­ dá»¥ng dataset Äá» set data-state
                        console.log(`  **SET data-state to: selected (dataset)**`); // Log thay Äá»i
                    } else {
                        compareButton.find('.icon-check').hide();
                        compareButton.find('.icon-refresh').show();
                        // **CHá»NH Sá»¬A: DIRECT DOM MANIPULATION - SET data-state**
                        compareButton[0].dataset.state = 'unselected'; // Sá»­ dá»¥ng dataset Äá» set data-state
                        console.log(`  **SET data-state to: unselected (dataset)**`); // Log thay Äá»i
                    }
                    feather.replace();
                    console.log(
                        `  After update: data-state: ${compareButton.attr('data-state')}, icon-refresh visible: ${compareButton.find('.icon-refresh').is(':visible')}, icon-check visible: ${compareButton.find('.icon-check').is(':visible')}`
                    );
                }
            }


            function updateCompareButtonInitialStatus() { // cáº­p nháº­t button ban Äáº§u
                const comparedProductIds = getCompareListFromCookie(); // **Äá»C DANH SÃCH ID Tá»ª COOKIE**
                comparedProductIds.forEach(function(productId) {
                    updateCompareButtonStatus(productId,
                        true); // khi load láº¡i trang, Cáº¬P NHáº¬T TRáº NG THÃI Dá»°A TRÃN COOKIE
                });
                updateCompareCount(); // Cáº¬P NHáº¬T BADGE Sá» LÆ¯á»¢NG Dá»°A TRÃN COOKIE
            }


            // $(document).ready(function() {

            updateCompareCount();
            updateCompareButtonInitialStatus();

            $('.compare-toggle').click(function(e) {
                e.preventDefault();
                var productId = $(this).data('product-id');
                var productCategoryId = $(this).data('product-category-id');
                var currentState = this.dataset.state;

                console.log(
                    `[compare-toggle click] productId: ${productId}, productCategoryId: ${productCategoryId}, currentState: ${currentState}`
                );

                if (currentState === 'unselected') {
                    console.log(`  Action: ThÃªm vÃ o giá» hÃ ng product to compare`);
                    addProductToCompare(productId,
                        productCategoryId); // **Äáº¢M Báº¢O DÃNG NÃY KHÃNG Bá» COMMENT VÃ GÃ ÄÃNG CHÃNH Táº¢**
                } else {
                    console.log(`  Action: Remove product from compare`);
                    removeFromCompareCookie(productId);
                    updateCompareCountBadgeCookie();
                    updateCompareButtonStatus(productId, false);
                }
            }); //end compare-toggle

            feather.replace(); // load láº¡i icon
            // });


            function addProductToCompare(productId, productCategoryId) { // GIá»® NGUYÃN tham sá»
                let compareListCookie = getCookie(compareCookieName);
                let compareList = compareListCookie ? JSON.parse(compareListCookie) : [];

                // Gá»­i AJAX request lÃªn backend Äá» kiá»m tra vÃ  thÃªm sáº£n pháº©m (vá»i check danh má»¥c)
                $.ajax({
                    url: '/api/compare/add-with-check/' +
                        productId, // **ÄÆ¯á»NG DáºªN API Má»I - CÃ PRODUCT ID TRONG URL**
                    method: 'POST',
                    data: {
                        compareList: compareList // Gá»­i danh sÃ¡ch so sÃ¡nh hiá»n táº¡i tá»« cookie
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            // Backend cho phÃ©p thÃªm sáº£n pháº©m
                            addProductToCompareCookie(productId); // ThÃªm vÃ o cookie
                            updateCompareCountBadgeCookie();
                            // **CHá»NH Sá»¬A 2: Bá»C updateCompareButtonStatus TRONG requestAnimationFrame (khi THÃM sáº£n pháº©m)**
                            requestAnimationFrame(() => { // **<-- THÃM requestAnimationFrame VÃO ÄÃY**
                                updateCompareButtonStatus(productId, true);
                            });
                            Swal.fire({
                                icon: 'success',
                                title: 'ThÃ nh cÃ´ng!',
                                text: 'Sáº£n pháº©m ÄÃ£ ÄÆ°á»£c thÃªm vÃ o danh sÃ¡ch so sÃ¡nh.',
                                showConfirmButton: true, // áº¨n nÃºt "OK" máº·c Äá»nh
                                // timer: 1500 // Tá»± Äá»ng ÄÃ³ng thÃ´ng bÃ¡o sau 1.5 giÃ¢y (1500ms)
                            });
                        } else if (response.status === 'error') {
                            // Backend bÃ¡o lá»i (vÃ­ dá»¥: khÃ´ng cÃ¹ng danh má»¥c)
                            alert(response.message); // Hiá»n thá» thÃ´ng bÃ¡o lá»i cho ngÆ°á»i dÃ¹ng
                            console.error('[addProductToCompare] Lá»i tá»« server:', response);
                        }
                    },
                    error: function(xhr, status, error) {
                        // **CALLBACK ERROR ÄÃ ÄÆ¯á»¢C CHá»NH Sá»¬A á» CÃC BÆ¯á»C TRÆ¯á»C - GIá»® NGUYÃN**
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Lá»i!',
                                text: xhr.responseJSON.message,
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Lá»i!',
                                text: 'Lá»i khi thÃªm sáº£n pháº©m vÃ o so sÃ¡nh. Vui lÃ²ng thá»­ láº¡i sau.',
                            });
                        }
                        console.error('[addProductToCompare] Lá»i AJAX request:', error);
                    }
                });
            }
        });
        // Wishlist Toggle
        $(document).on('click', '.wishlist-toggle', function(e) {
            e.preventDefault();

            @guest
// Náº¿u chÆ°a ÄÄng nháº­p, hiá»n thá» thÃ´ng bÃ¡o yÃªu cáº§u ÄÄng nháº­p
        Swal.fire({
            icon: 'warning',
            title: 'Báº¡n chÆ°a ÄÄng nháº­p!',
            text: 'Vui lÃ²ng ÄÄng nháº­p Äá» thÃªm sáº£n pháº©m vÃ o danh sÃ¡ch yÃªu thÃ­ch.',
            showConfirmButton: true,
            confirmButtonText: 'ÄÄng nháº­p',
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/login'; // Äiá»u hÆ°á»ng Äáº¿n trang ÄÄng nháº­p
            }
        });
        return; // Dá»«ng xá»­ lÃ½ tiáº¿p theo @endguest

            var productId = $(this).data('product-id'); // Láº¥y product ID
            var icon = $(this).find('.wishlist-icon'); // Chá» chá»n icon trong element hiá»n táº¡i

            $.ajax({
                url: `/account/wishlist/toggle/${productId}`,
                type: 'POST',
                headers: {
                    'X-CSRF-TOKEN': '{{ csrf_token() }}',
                },
                data: {
                    product_id: productId
                },
                success: function(data) {
                    if (data.result) {
                        Swal.fire({
                            icon: 'success',
                            title: data.action === 'added' ? 'ÄÃ£ thÃªm!' : 'ÄÃ£ xÃ³a!',
                            text: data.action === 'added' ?
                                'Sáº£n pháº©m ÄÃ£ ÄÆ°á»£c thÃªm vÃ o danh sÃ¡ch yÃªu thÃ­ch!' :
                                'Sáº£n pháº©m ÄÃ£ bá» xÃ³a khá»i danh sÃ¡ch yÃªu thÃ­ch!',
                            timer: 1500,
                            showConfirmButton: false
                        }).then(() => {
                            location.reload(); // Load láº¡i trang sau khi hiá»n thá» thÃ´ng bÃ¡o
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Lá»i!',
                            text: data.message || 'CÃ³ lá»i xáº£y ra, vui lÃ²ng thá»­ láº¡i!',
                        });
                    }
                },
                error: function(xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lá»i!',
                        text: 'CÃ³ lá»i xáº£y ra, vui lÃ²ng thá»­ láº¡i!',
                    });
                }
            });
        });
    </script>
@endpush
